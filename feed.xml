<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="zh-tw"><generator uri="https://jekyllrb.com/" version="4.2.0">Jekyll</generator><link href="https://homuchen.com/feed.xml" rel="self" type="application/atom+xml" /><link href="https://homuchen.com/" rel="alternate" type="text/html" hreflang="zh-tw" /><updated>2021-06-23T17:30:24+08:00</updated><id>https://homuchen.com/feed.xml</id><title type="html">HoMuChen</title><subtitle>æˆ‘æ˜¯é™³æ²³ç©†ï¼ŒHoMuChenï¼ŒA Software Engineer é€™è£¡æ˜¯æˆ‘çš„å€‹äººç¶²ç«™éƒ¨è½æ ¼ï¼Œç”¨ä¾†ç´€éŒ„è‡ªå·±å­¸ç¿’çš„æ­·ç¨‹</subtitle><entry><title type="html">What are HTTP Methodsï¼ŸWhich to use and How to use them correctly?</title><link href="https://homuchen.com/posts/http-methods-which-to-use-and-how-to-use-them-correctly/" rel="alternate" type="text/html" title="What are HTTP Methodsï¼ŸWhich to use and How to use them correctly?" /><published>2021-04-04T20:00:00+08:00</published><updated>2021-04-04T20:00:00+08:00</updated><id>https://homuchen.com/posts/http-methods-which-to-use-and-how-to-use-them-correctly</id><content type="html" xml:base="https://homuchen.com/posts/http-methods-which-to-use-and-how-to-use-them-correctly/">&lt;p&gt;é€™ç¯‡æ–‡ç« ä¸»è¦è¨è«–å¹¾å€‹å¸¸è¦‹çš„HTTP methodsï¼Œèªªæ˜ä»–å€‘åˆ†åˆ¥æ˜¯å¦å…·æœ‰å“ªäº›ç‰¹æ€§(Safeã€Idempotent)ï¼Œä»¥åŠä»–å€‘æ‡‰è©²è¦æ€éº¼ä½¿ç”¨ï¼Œæ¯”è¼ƒæœƒæ˜¯ç¬¦åˆå¤§å®¶çš„æœŸå¾…ï¼&lt;/p&gt;

&lt;p&gt;ç•¶ç„¶å¯«serverçš„äººå¯ä»¥ä¸ç…§è‘—æ…£ä¾‹èµ°ï¼Œä¸éå¦‚æ­¤ä¸€ä¾†ï¼Œä½¿ç”¨é€™å€‹APIçš„userå¯èƒ½æœƒå¾ˆä¸é«˜èˆˆï¼Œè€Œé€™å€‹userå¯ä»¥æ˜¯å…¬å¸çš„å®¢æˆ¶ï¼Œå¯èƒ½æ˜¯å…¬å¸å…§éƒ¨çš„å…¶ä»–åœ˜éšŠï¼Œä¹Ÿå¯èƒ½æ˜¯æœªä¾†çš„è‡ªå·±ï¼&lt;/p&gt;

&lt;h1 id=&quot;outline&quot;&gt;Outline&lt;/h1&gt;
&lt;ul&gt;
  &lt;li&gt;HTTP Request messageæ ¼å¼&lt;/li&gt;
  &lt;li&gt;å¸¸è¦‹çš„methodsï¼Œä»¥åŠå…¶ç‰¹æ€§&lt;/li&gt;
  &lt;li&gt;åˆ†åˆ¥ä»‹ç´¹å„å€‹methodçš„ç”¨æ³•&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;http-request-message&quot;&gt;HTTP Request message&lt;/h1&gt;
&lt;p&gt;ä¸€å€‹generalçš„HTTP request messageå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&amp;lt;method&amp;gt; &amp;lt;URL&amp;gt; &amp;lt;version&amp;gt;
&amp;lt;header&amp;gt;
...
...
&amp;lt;header&amp;gt;
&amp;lt;body&amp;gt; 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ç¬¬ä¸€å€‹å­—å°±æ˜¯methodï¼Œæ¥è‘—ç‚ºURLè·Ÿversionï¼Œæ›è¡Œå¾Œç‚ºè¨±å¤šå€‹headerï¼Œæ¯å€‹headerä»¥æ›è¡Œéš”é–‹ï¼Œæœ€å¾Œå†éš”ä¸€è¡Œä¹‹å¾Œæ˜¯bodyï¼&lt;/p&gt;

&lt;p&gt;å°æ–¼HTTP messageé‚„ä¸ç†Ÿçš„ï¼Œå¯ä»¥çœ‹æˆ‘ä¹‹å‰å¯«çš„æ–‡ç« ï¼š[Networking] HTTP ç°¡ä»‹ï¼Œä»¥åŠä½¿ç”¨telnetã€ncã€curlç­‰æŒ‡ä»¤ä¾†æ¢ç´¢&lt;/p&gt;

&lt;p&gt;URLä»£è¡¨è‘—è³‡æºï¼Œè€Œmethodæ˜¯ä½ æƒ³è¦å°è³‡æºé€²è¡Œçš„æ“ä½œï¼Œå¸¸è¦‹çš„methodå¦‚ä¸‹è¡¨ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://storage.googleapis.com/homuchen.com/images/header-1.jpg&quot; alt=&quot;http headers&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;dont-surprise-your-user&quot;&gt;Donâ€™t surprise your user&lt;/h1&gt;
&lt;p&gt;ä¸¦ä¸æ˜¯æ‰€æœ‰çš„serveréƒ½æœƒå¯¦ä½œæ‰€æœ‰çš„methodï¼Œè€Œä¸”æ¯å€‹methodè¦åšä»€éº¼äº‹ï¼Œä¹Ÿéƒ½æ˜¯ç”±serveræ‰€æ±ºå®šçš„ï¼Œä½†æ˜¯ä¸€å€‹å¥½çš„APIé€šå¸¸ä¸æœƒåšæ€ªæ€ªçš„äº‹ï¼Œè€Œæ˜¯è¦ç¬¦åˆä½¿ç”¨è€…çš„æœŸå¾…ï¼Œä½¿å…¶é«”é©—è‰¯å¥½ï¼Œé€™è£¡å…ˆä¾†è§£é‡‹ä¸€ä¸‹safeåŠIdempotenté€™å…©å€‹ç‰¹æ€§æ˜¯ä»€éº¼å§ï¼&lt;/p&gt;
&lt;h2 id=&quot;safe&quot;&gt;Safe&lt;/h2&gt;
&lt;p&gt;å¦‚æœä¸€å€‹requestæ˜¯safeçš„ï¼ŒæŒ‡çš„æ˜¯ä»–ä¸æœƒå°è‡´serverå»åšä¸€äº›é¡å¤–çš„å‹•ä½œï¼Œæ²’æœ‰side effectï¼Œä¾‹å¦‚èªªæ”¹è®Šstateã€åˆ·ä½ ä¿¡ç”¨å¡ï¼Œé€™æ¨£çš„requeståŸºæœ¬ä¸Šå°±æ˜¯read-onlyçš„ï¼
é€™æ¨£çš„ç‰¹æ€§ï¼Œä½¿å¾—APIçš„userå¯ä»¥å¤§è†½æ”¾å¿ƒåœ°å»å‘¼å«ï¼Œå¯¦é©—ä½ çš„APIï¼Œè€Œä¸å¿…æ“”å¿ƒæœƒå¼•ç™¼ä»€éº¼ç„¡æ³•æŒ½å›çš„å¾Œæœï¼ŒGETã€HEADã€OPTIONSéƒ½æ˜¯å…·æœ‰safeç‰¹æ€§çš„methodï¼&lt;/p&gt;
&lt;h2 id=&quot;idempotent&quot;&gt;Idempotent&lt;/h2&gt;
&lt;p&gt;ä¸€å€‹Idempotentçš„æ“ä½œï¼ŒæŒ‡çš„æ˜¯é€™æ¨£çš„æ“ä½œåŸ·è¡Œä¸€æ¬¡è·ŸåŸ·è¡Œå¾ˆå¤šæ¬¡çš„çµæœæ˜¯ä¸€æ¨£çš„ï¼ä¾‹å¦‚æ•¸å­¸ä¸Šçš„ä¹˜ä»¥1ï¼Œä¹˜ä»¥0ï¼Œä¸€å€‹æ˜¯æ•¸å­—ä¹˜ä»¥1æˆ–ä¹˜ä»¥0ä¸ç®¡å¤šå°‘æ¬¡ï¼Œçµæœéƒ½æ˜¯åŸæœ¬çš„æ•¸å­—æˆ–è€…æ˜¯0ï¼&lt;/p&gt;

&lt;p&gt;é‚£æœ‰Idempotentçš„ç‰¹æ€§ï¼Œå¯ä»¥å¸¶ä¾†ä»€éº¼å¥½è™•å‘¢ï¼Ÿå°±æ˜¯userå¯ä»¥æ”¾å¿ƒçš„retryï¼Œç•¶userä¸ç¢ºå®šå‰›å‰›çš„operationã€requestæœ‰æ²’æœ‰æˆåŠŸæ™‚(å¯èƒ½é€å‡ºå¾Œç¶²è·¯çªç„¶æ–·æ‰ã€serveråšå®Œä¹‹å¾Œå†å›æ‡‰ä¹‹å‰æ›æ‰ã€ç­‰ç­‰â€¦)ï¼Œå°±å†åšä¸€æ¬¡ï¼&lt;/p&gt;

&lt;p&gt;è€ŒHTTP methodä¸­ï¼Œé™¤äº†POSTï¼Œå…¶ä»–methodéƒ½é æœŸæ‡‰è©²æ˜¯Idempotentçš„ï¼ŒUpdateå¥½å¹¾æ¬¡ï¼ŒDeleteå¥½å¹¾æ¬¡ï¼Œæ‡‰è©²éƒ½è·Ÿåªåšä¸€æ¬¡çš„çµæœä¸€è‡´ï¼&lt;/p&gt;

&lt;h1 id=&quot;http-methods&quot;&gt;HTTP Methods&lt;/h1&gt;
&lt;p&gt;çœ‹å®Œäº†å…±åŒçš„ç‰¹æ€§ä¹‹å¾Œï¼Œæ¥è‘—ä¾†çœ‹çœ‹çµ¦å€‹methodé æœŸæ˜¯æ€éº¼ä½¿ç”¨ï¼Œä»¥åŠserverå¦‚ä½•å›æ‡‰å„ç¨®æƒ…æ³ï¼&lt;/p&gt;

&lt;h2 id=&quot;get&quot;&gt;GET&lt;/h2&gt;
&lt;p&gt;æœ€å¸¸è¦‹çš„methodä¹‹ä¸€ï¼Œé¡§åæ€ç¾©å°±æ˜¯ç”¨ä¾†å‘serverç´¢å–ä¸€äº›è³‡æºï¼&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;æœ‰è³‡æºï¼Œserverå°±å›æ‡‰200ä»¥åŠè³‡æº&lt;/li&gt;
  &lt;li&gt;æ²’æœ‰è³‡æºï¼Œ404&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;head&quot;&gt;HEAD&lt;/h2&gt;
&lt;p&gt;è·ŸGETéƒ½ä¸€æ¨£ï¼Œä½†serverä¸¦ä¸å›å‚³è³‡æºæœ¬èº«ï¼Œè€Œæ˜¯åªå›æ‡‰headersï¼&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&amp;lt;Response&amp;gt;
HTTP/1.1 200 OK
Content-Type: plain/html
Content-Length: 614
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;options&quot;&gt;OPTIONS&lt;/h2&gt;
&lt;p&gt;ç”¨ä¾†è©¢å•serverå°ç‰¹å®šçš„è³‡æºï¼Œæœ‰æ”¯æ´å“ªäº›æ“ä½œï¼&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;å°‡çµæœç½®æ–¼header Allowè£¡ï¼Œå¦‚ä¸‹ï¼š
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&amp;lt;Response&amp;gt;
HTTP/1.1 200 OK
Allow: GET, POST, PUT, OPTIONS
Content-Length: 0
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;put&quot;&gt;PUT&lt;/h2&gt;
&lt;p&gt;Replace the entire resourceï¼Œå°æ‡‰åˆ°CRUDè£¡çš„updateï¼Œå°±æ˜¯å«serverå°‡æˆ‘request bodyè£¡çš„è³‡æ–™å­˜èµ·ä¾†ï¼Œå¦‚æœè³‡æºæœ¬ä¾†ä¸å­˜åœ¨å°±createï¼Œåœ¨çš„è©±å°±replaceï¼&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;200 OKï¼ŒæˆåŠŸ&lt;/li&gt;
  &lt;li&gt;204 No Contentï¼ŒæˆåŠŸä½†ç•«é¢ä¸éœ€è¦æ›´æ–°ï¼Œä¹Ÿå°±æ˜¯æ²’æœ‰æ–°çš„è³‡æ–™ç”¢ç”Ÿï¼Œclientä¸å¿…å–çš„æ–°çš„è³‡æ–™ï¼Œä¾‹å¦‚èªªclientåœ¨æ›´æ–°è¡¨å–®æŒ‰ä¸‹saveæ™‚ï¼&lt;/li&gt;
  &lt;li&gt;201 Createdï¼Œå¦‚æœæ˜¯createçš„è©±ï¼Œä¸¦ä¸”åœ¨header Locationæ”¾ä¸Šè³‡æºçš„URI
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&amp;lt;Response&amp;gt;
HTTP/1.1 201 Created
Location: https://api.example.com/users/123 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;patch&quot;&gt;PATCH&lt;/h2&gt;
&lt;p&gt;Update parts of the resourceï¼Œè·ŸPUTä¸€æ¨£æ˜¯updateï¼Œä¸éæ˜¯partial updateæˆ–è€…èªªæ˜¯mergeï¼
æ¯”å¦‚èªªåŸæœ¬æœ‰å€‹homuchençš„useræ˜¯é•·é€™æ¨£ï¼š&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;{
    &quot;name&quot;: &quot;HoMuChen&quot;,
    &quot;age&quot;: 30
}
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ç•¶ä½ PATCHæ™‚ï¼Œæƒ³è¦å°‡ageæ›´æ–°ç‚º31&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&amp;lt;Request&amp;gt;
PATCH /users/homuchen HTTP/1.1
Content-Type: application/json
Content-Length: 11
{&quot;age&quot;: 31}
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;çµæœç‚º&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;{
    &quot;name&quot;: &quot;HoMuChen&quot;,
    &quot;age&quot;: 31
}
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;å¦‚æœæ˜¯ç”¨PUTï¼Œå‰‡æœƒæ•´å€‹replaceæ‰ï¼Œnameå°±ä¸è¦‹äº†&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;{
    &quot;age&quot;: 31
}
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;post&quot;&gt;POST&lt;/h2&gt;
&lt;p&gt;ä¸€èˆ¬ä¾†èªªæ˜¯æŒ‡æŠŠè³‡æ–™å‚³çµ¦serverå»åšè™•ç†ï¼Œç•¶ä½¿ç”¨å…¶ä»–çš„methodï¼Œèªæ„ç„¡æ³•ç¬¦åˆæ™‚ï¼Œå°±æœƒä½¿ç”¨POSTï¼Œå¸¸è¦‹çš„æœ‰ç”¨æ–¼Create resourcesã€Search queryã€Asynchronous tasksï¼&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;200 OK&lt;/li&gt;
  &lt;li&gt;201 Created&lt;/li&gt;
  &lt;li&gt;202 Acceptedï¼Œserverå·²æ¥å—è«‹æ±‚ï¼Œä½†é‚„éœ€è¦æ™‚é–“å»å®Œæˆä»»å‹™ï¼&lt;/li&gt;
  &lt;li&gt;Search Query: Ex. &lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html&quot;&gt;Elasticsearch Query DSL&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;delete&quot;&gt;DELETE&lt;/h2&gt;
&lt;p&gt;é¡§åæ€ç¾©ï¼Œç”¨ä¾†åˆªé™¤è³‡æºï¼&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;200 OKï¼&lt;/li&gt;
  &lt;li&gt;207ï¼Œbulk deleteï¼&lt;/li&gt;
  &lt;li&gt;404 Not Foundï¼Œè¦åˆªé™¤çš„è³‡æºä¸å­˜åœ¨ï¼&lt;/li&gt;
  &lt;li&gt;410 Goneï¼Œè³‡æºå·²è¢«åˆªé™¤ï¼&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;summary&quot;&gt;Summary&lt;/h1&gt;
&lt;p&gt;HTTPåšç‚ºç¶²è·¯ä¸–ç•Œä¸­çœ¾å¤šé€šè¨Šå”å®šä¸­çš„ä¸€å€‹ï¼Œåªæœ‰ç•¶æˆ‘å€‘æ›´åŠ äº†è§£ä»–ï¼Œservice provideræ‰èƒ½æä¾›æ›´å¥½ç”¨ã€å¦client userçš„å­¸ç¿’æ›²ç·šä½ï¼Œç”¨èµ·ä¾†å¾ˆé–‹å¿ƒçš„æœå‹™ï¼&lt;/p&gt;

&lt;p&gt;ä»Šå¤©ç°¡å–®åœ°è¨è«–äº†å„å€‹HTTP Methodçš„ç”¨æ³•ï¼Œæ¯å€‹methodæœ‰ä»–çš„èªæ„ï¼Œåªæœ‰ç•¶serverç…§è‘—å¤§å®¶çš„é æœŸå»åšæ™‚ï¼Œæ‰ä¸æœƒé€ æˆå¤§å®¶çš„å›°æ“¾ï¼&lt;/p&gt;

&lt;p&gt;é™¤äº†Methodä¹‹å¤–ï¼Œé‚„æœ‰Response codeã€Headerç­‰å…¶ä»–HTTPçš„çµ„æˆéœ€è¦å»äº†è§£ï¼Œæœ€å¾Œæ•´å€‹APIç¬¦åˆRESTfulçš„styleæ˜¯é€™ä¸€ç³»åˆ—æ–‡ç« çš„ç›®æ¨™ï¼&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;æ„Ÿè¬å¤§å®¶çš„é–±è®€ï¼Œå¦‚æœ‰éŒ¯èª¤æ­¡è¿æŒ‡æ­£ï¼Œæˆ‘æ˜¯æ²³ç©†ï¼Œæˆ‘å€‘ä¸‹æ¬¡è¦‹ï¼&lt;/p&gt;</content><author><name></name></author><category term="API Design" /><category term="restful api" /><category term="api" /><category term="http" /><summary type="html">é€™ç¯‡æ–‡ç« ä¸»è¦è¨è«–å¹¾å€‹å¸¸è¦‹çš„HTTP methodsï¼Œèªªæ˜ä»–å€‘åˆ†åˆ¥æ˜¯å¦å…·æœ‰å“ªäº›ç‰¹æ€§(Safeã€Idempotent)ï¼Œä»¥åŠä»–å€‘æ‡‰è©²è¦æ€éº¼ä½¿ç”¨ï¼Œæ¯”è¼ƒæœƒæ˜¯ç¬¦åˆå¤§å®¶çš„æœŸå¾…ï¼</summary></entry><entry><title type="html">ä»€éº¼æ˜¯ç¶²è·¯ï¼Ÿç¶²è·¯çš„çµ„æˆåŠç¶²è·¯æœå‹™ä¾›æ‡‰å•† ISP</title><link href="https://homuchen.com/posts/what-is-networking-and-isp/" rel="alternate" type="text/html" title="ä»€éº¼æ˜¯ç¶²è·¯ï¼Ÿç¶²è·¯çš„çµ„æˆåŠç¶²è·¯æœå‹™ä¾›æ‡‰å•† ISP" /><published>2020-04-04T20:00:00+08:00</published><updated>2020-04-04T20:00:00+08:00</updated><id>https://homuchen.com/posts/what-is-networking-and-isp</id><content type="html" xml:base="https://homuchen.com/posts/what-is-networking-and-isp/">&lt;p&gt;ç¶²è·¯ï¼Œå¯èƒ½æ˜¯äººé¡æœ€å¤§çš„å·¥ç¨‹æˆå°±ä¹‹ä¸€ï¼Œå¦‚ä»Šæœ‰æ•¸åå„„çš„äººé€éç¶²è·¯é€£æ¥ï¼Œåœ¨å¹¾ç§’é˜ä¹‹å…§å°±èƒ½å¤ äº’ç›¸é€šè¨Šã€å®ŒæˆæŸç¨®ä»»å‹™ï¼Œå„ç¨®è£ç½®äº’ç›¸é€£çµï¼ŒåŒ…æ‹¬ä¼ºæœå™¨ï¼Œå€‹äººæ¡Œä¸Šå‹é›»è…¦ã€å¹³æ¿ã€æ‰‹æ©Ÿã€æœªä¾†é‚„æœƒæœ‰æ›´å¤šæ¨£çš„thingsåŠ å…¥ï¼Œä¾‹å¦‚è»Šå­ã€å®¶é›»ã€å„ç¨®æ„Ÿæ¸¬å™¨ ï¼Œç­‰ç­‰ï¼å¦‚æ­¤å·¨å¤§çš„å·¥ç¨‹ï¼Œå¤§è¦æ¨¡çš„å…¨ä¸–ç•Œçš„å…±åŒåˆä½œï¼Œåˆ°åº•æ˜¯å¦‚ä½•åšåˆ°çš„ï¼Ÿå·¥ç¨‹æ¶æ§‹çš„æ±ºå®šã€å”è­°çš„åˆ¶å®šéƒ½å€¼å¾—å»å€Ÿé¡å­¸ç¿’ï¼&lt;/p&gt;

&lt;h1 id=&quot;ç¶²è·¯çš„çµ„æˆ&quot;&gt;ç¶²è·¯çš„çµ„æˆ&lt;/h1&gt;

&lt;p&gt;ç¶²è·¯é€£æ¥äº†ä¸–ç•Œä¸Šæ•¸åå„„çš„è£ç½®ï¼Œé€™äº›é€£ä¸Šç¶²è·¯çš„è£ç½®å°±ç¨±ç‚ºhosts, end-systemsï¼Œè€Œç¶²è·¯æœ¬èº«ç”±communocation linksåŠpackets switchesçµ„æˆï¼Œlinkså°±æ˜¯æŒ‡é›»è©±ç·šå‘€ã€åŒè»¸é›»çºœã€å…‰çº–ã€é›»ç£æ³¢é »è­œé€™äº›å¯¦éš›å‚³é€è³‡æ–™çš„åª’ä»‹ï¼Œè€Œè³‡æ–™å¾ä¸€å€‹hoståˆ°å¦ä¸€å€‹hostæ˜¯è¢«æ‹†åˆ†æˆè¨±å¤šä¸€å€‹ä¸€å€‹çš„packetï¼Œè—‰ç”±linkå‚³é€ï¼Œåˆ°é”packets switchesï¼Œæ¯å€‹switchå‰‡è² è²¬æŠŠpacketå¾é€²ä¾†çš„linké¸æ“‡ä¸€å€‹linkå‚³å‡ºå»ï¼Œæœ€å¾Œåˆ°é”ç›®çš„åœ°ï¼&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://storage.googleapis.com/homuchen.com/images/isp-2.jpg&quot; alt=&quot;networking&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é‚£åˆ°åº•æ˜¯èª°æä¾›é€™äº›linksåŠswitchesçµ¦æˆ‘å€‘çš„è£ç½®å»é€£æ¥ä¸Šå‘¢ï¼Ÿå°±æ˜¯ç¶²éš›ç¶²è·¯æœå‹™ä¾›æ‡‰å•†ï¼ŒInternet Service Providerï¼ŒISPï¼&lt;/p&gt;

&lt;h1 id=&quot;internet-service-providerisp&quot;&gt;Internet Service Provider(ISP)&lt;/h1&gt;

&lt;p&gt;åœ¨å°ç£ï¼Œç•¶æˆ‘å€‘æƒ³è¦ä½¿ç”¨ç¶²è·¯æ™‚ï¼Œå°±è¦å»æ‰¾ä¸­è¯é›»ä¿¡ã€é å‚³ã€å°ç£å¤§å“¥å¤§ç­‰ç­‰çš„é›»ä¿¡å•†ï¼Œä»–å€‘å°±æ˜¯ISPï¼Œè² è²¬å»ºè¨­åŸºç¤è¨­æ–½ï¼Œè¨­å®šé€£çµï¼Œæˆ‘å€‘é€éè¡Œå‹•ç¶²è·¯ã€å…‰çº–ã€DSLé€£ä¸Šï¼Œç¶²è·¯ä¾›æ‡‰å•†çš„è¨­å‚™å°±æœƒè² è²¬å‚³éè³‡æ–™ä¾†å¾€æ–¼æˆ‘å€‘èˆ‡ç›®çš„åœ°ä¹‹é–“ï¼&lt;/p&gt;

&lt;p&gt;æ¯”å¦‚Aè·ŸBéƒ½å»äº†ä¸­è¯é›»ä¿¡ç”³è«‹äº†ç¶²è·¯æœå‹™ï¼Œé€£æ¥ä¸Šå¾ŒAåŠBä¹‹é–“å°±èƒ½äº’ç›¸é€šè¨Šäº†ï¼Œé‚£ç¾åœ¨Cä½¿ç”¨äº†é å‚³çš„æœå‹™ï¼ŒABåŠCè©²è¦æ€éº¼é€šè¨Šå‘¢?å¦‚æœä¸­è¯é›»ä¿¡è·Ÿé å‚³ä¹‹é–“äº’ç›¸é€£æ¥èµ·ä¾†å°±å¯ä»¥äº†ï¼&lt;/p&gt;

&lt;p&gt;é‚£å…¨çƒæœ‰é‚£éº¼å¤šçš„ç”¨æˆ¶ï¼Œå„è‡ªä½¿ç”¨å„è‡ªçš„æœå‹™ä¾›æ‡‰å•†ï¼Œå¦‚æœå…¨éƒ¨éƒ½å¿…é ˆè¦èƒ½å¤ äº’ç›¸é€šè¨Šï¼Œå°±å¿…é ˆè¦å…¨éƒ¨çš„ç¶²è·¯æœå‹™ä¾›æ‡‰å•†éƒ½äº’ç›¸é€£æ¥æ‰è¡Œï¼Œä½†é€™è¦æœ‰é»å¤ªä¸å¯¦éš›äº†ï¼Œé€£çµçš„æ•¸é‡å¤ªéé¾å¤§ï¼Œæˆæœ¬éå¸¸é«˜ï¼&lt;/p&gt;

&lt;p&gt;ç¾åœ¨å‡è¨­æœ‰å€‹å…¨çƒç¯„åœçš„æœå‹™ä¾›æ‡‰å•†ï¼Œå„åœ°å€çš„ä¾›æ‡‰å•†åªè¦æ¥ä¸Šå»å°±å¯ä»¥äº†ï¼Œä¸‹å±¤çš„æœå‹™ä¾›æ‡‰å•†æˆäº†ä¸Šå±¤çš„å®¢æˆ¶ï¼Œä¾æ“šæµé‡ä»˜è²»ï¼Œæœ‰éŒ¢è³ºçš„ç”Ÿæ„ç•¶ç„¶å°±æœ‰è¨±å¤šäººé€²ä¾†åšï¼Œè¨±å¤šç«¶çˆ­çš„ä¾›æ‡‰å•†åŠ å…¥ï¼Œå½¼æ­¤ä¹Ÿå¯ä»¥äº’ç›¸é€£çµï¼Œå®¢æˆ¶ä¹Ÿå¯ä»¥è·Ÿå¤šå€‹ä¾›æ‡‰å•†åˆä½œï¼Œå¦‚æ­¤ç•¶æœ‰ä»»ä¸€ä¾›æ‡‰å•†æœå‹™ä¸­æ–·ï¼Œä¹Ÿä¸æœƒå½±éŸ¿çµ‚ç«¯ç”¨æˆ¶ï¼&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://storage.googleapis.com/homuchen.com/images/isp-3.jpg&quot; alt=&quot;networking&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ–¼æ˜¯ç¶²è·¯å°±æˆäº†éšå±¤å¼çš„æ¶æ§‹ï¼Œä¸Šä¸‹å±¤çš„å®¢æˆ¶é—œä¿‚ï¼ŒåŒå±¤ä¹‹é–“ä¹Ÿæœƒäº’ç›¸é€£æ¥ï¼Œå„å€‹ä¾›æ‡‰å•†è‡ªå·±è² è²¬å»ºè¨­è‡ªå·±çš„åŸºç¤è¨­æ–½åŠè¨­å®šè·¯ç”±ï¼Œå°åŒ…çš„å‚³é€å¯èƒ½æœƒæœ‰ç¶“æ¿Ÿçš„è€ƒé‡(ç›¡é‡ä¸èµ°ä¸Šå±¤ä¾›æ‡‰å•†ï¼Œå› ç‚ºè¦éŒ¢ï¼Œåªåœ¨åŒå±¤ä¹‹é–“äº¤æ›)ã€æˆ–è€…æ˜¯æ”¿æ²»è€ƒé‡(ä¸æƒ³å°åŒ…ç¶“éæŸæŸåœ‹å®¶çš„è¨­å‚™ï¼Œæˆ–æ˜¯æ‰€ä»¥å°åŒ…éƒ½è¦ç¶“éæŸåœ°ï¼Œä»¥åˆ©ç›£æ§ã€é˜»æ“‹æŸäº›ä¾†æº)ï¼&lt;/p&gt;</content><author><name>HoMuChen</name></author><category term="Networking" /><category term="networking" /><category term="ISP" /><summary type="html">ç¶²è·¯ï¼Œå¯èƒ½æ˜¯äººé¡æœ€å¤§çš„å·¥ç¨‹æˆå°±ä¹‹ä¸€ï¼Œå¦‚ä»Šæœ‰æ•¸åå„„çš„äººé€éç¶²è·¯é€£æ¥ï¼Œåœ¨å¹¾ç§’é˜ä¹‹å…§å°±èƒ½å¤ äº’ç›¸é€šè¨Šã€å®ŒæˆæŸç¨®ä»»å‹™ï¼Œå„ç¨®è£ç½®äº’ç›¸é€£çµï¼ŒåŒ…æ‹¬ä¼ºæœå™¨ï¼Œå€‹äººæ¡Œä¸Šå‹é›»è…¦ã€å¹³æ¿ã€æ‰‹æ©Ÿã€æœªä¾†é‚„æœƒæœ‰æ›´å¤šæ¨£çš„thingsåŠ å…¥ï¼Œä¾‹å¦‚è»Šå­ã€å®¶é›»ã€å„ç¨®æ„Ÿæ¸¬å™¨ ï¼Œç­‰ç­‰ï¼å¦‚æ­¤å·¨å¤§çš„å·¥ç¨‹ï¼Œå¤§è¦æ¨¡çš„å…¨ä¸–ç•Œçš„å…±åŒåˆä½œï¼Œåˆ°åº•æ˜¯å¦‚ä½•åšåˆ°çš„ï¼Ÿå·¥ç¨‹æ¶æ§‹çš„æ±ºå®šã€å”è­°çš„åˆ¶å®šéƒ½å€¼å¾—å»å€Ÿé¡å­¸ç¿’ï¼</summary></entry><entry><title type="html">ä»€éº¼æ˜¯message queue? å„ªé»åŠä½¿ç”¨å ´æ™¯</title><link href="https://homuchen.com/posts/message-queue-advantages-use-cases/" rel="alternate" type="text/html" title="ä»€éº¼æ˜¯message queue? å„ªé»åŠä½¿ç”¨å ´æ™¯" /><published>2019-12-13T20:00:00+08:00</published><updated>2019-12-13T20:00:00+08:00</updated><id>https://homuchen.com/posts/message-queue-advantages-use-cases</id><content type="html" xml:base="https://homuchen.com/posts/message-queue-advantages-use-cases/">&lt;p&gt;åœ¨å¤§å‹ç¶²é æ‡‰ç”¨ç¨‹å¼ç³»çµ±ä¸­ï¼Œç•¶æˆ‘å€‘çš„æœå‹™è¶Šä¾†è¶Šå¤šï¼Œæœå‹™ä¹‹é–“å°±éœ€è¦æºé€šï¼Œé€éhttp restful apiï¼Œæƒ³å¿…å¤§å®¶éƒ½ä¸€å®šé‡éï¼Œæˆ–è¨±æˆ–å¤šæˆ–å°‘ä¹Ÿè½éä½¿ç”¨message queueï¼Œé‚£åˆ°åº•å®ƒæ˜¯ä»€éº¼ï¼Ÿç‚ºä»€éº¼è¦ç”¨å®ƒï¼Ÿä»¥åŠè·Ÿrestful apiæœ‰ä½•ä¸åŒçš„ä½¿ç”¨å ´æ™¯å‘¢ï¼Ÿ&lt;/p&gt;

&lt;h1 id=&quot;ä»€éº¼æ˜¯message-queue&quot;&gt;ä»€éº¼æ˜¯message queue?&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;https://storage.googleapis.com/homuchen.com/images/mq-1.jpg&quot; alt=&quot;message queue&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é¡§åæ€ç¾©ï¼Œå°±æ˜¯æœ‰å€‹queueï¼Œè¨Šæ¯å…ˆå…¥å…ˆå‡º( FIFO )ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯æä¾›ä¸€å€‹è®“ä¸åŒprocessé–“é€šè¨Šçš„æ–¹å¼( asynchronous messaging )ï¼Œæœƒæœ‰ç”¢ç”Ÿè¨Šæ¯çš„producerï¼ŒåŠæ¶ˆè€—è™•ç†è¨Šæ¯çš„consumerï¼&lt;/p&gt;

&lt;h1 id=&quot;ç‚ºä½•ä½¿ç”¨&quot;&gt;ç‚ºä½•ä½¿ç”¨ï¼Ÿ&lt;/h1&gt;

&lt;p&gt;ç‚ºä»€éº¼è¦ä½¿ç”¨message queueå‘¢ï¼Ÿ ä»–èƒ½å¸¶çµ¦æˆ‘å€‘å“ªäº›å¥½è™•ï¼Ÿ&lt;/p&gt;

&lt;h2 id=&quot;fault-tolerance&quot;&gt;Fault tolerance&lt;/h2&gt;
&lt;p&gt;ä¸€ä½†è¨Šæ¯è¢«æˆåŠŸé€é€²queueè£¡ï¼Œåœ¨ä»–è¢«æˆåŠŸæ¶ˆè€—æ‰ä¹‹å‰ï¼Œéƒ½æœƒä¿å­˜è‘—ï¼Œæœ‰æ™‚å¯èƒ½å› ç‚ºè«ååŸå› ï¼Œconsumeréƒ½æ›äº†ï¼Œåœ¨consumeræ¢å¾©ä¹‹å‰ï¼Œéœ€è¦åšçš„ä»»å‹™é‚„ç•™è‘—ï¼Œèƒ½å¤ ç­‰åˆ°æ¢å¾©ä¹‹å¾Œå†ç¹¼çºŒè™•ç†ï¼&lt;/p&gt;

&lt;h2 id=&quot;decoupling&quot;&gt;Decoupling&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://storage.googleapis.com/homuchen.com/images/mq-2.jpg&quot; alt=&quot;decoupling&quot; /&gt;
è¨Šæ¯çš„ç™¼é€æ–¹å’Œæ¥å—æ–¹éƒ½ä¸éœ€è¦çŸ¥é“å½¼æ­¤ï¼Œconsumerå’Œproduceå¯ä»¥éš¨ä¾¿ä½ ç”¨ä¸åŒèªè¨€å¯¦ä½œï¼Œåªè¦messageçš„æ ¼å¼äº‹å…ˆæœ‰æºé€šå¥½ï¼ŒçŸ¥é“å°±å¥½ï¼&lt;/p&gt;

&lt;h2 id=&quot;scaling&quot;&gt;Scaling&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://storage.googleapis.com/homuchen.com/images/mq-3.jpg&quot; alt=&quot;scaling&quot; /&gt;
ç³»çµ±å¯èƒ½æœ‰æ™‚æœƒçªç„¶é¢è‡¨å¤§çš„æµé‡ï¼Œæ­¤æ™‚queueå°±æä¾›äº†ä¸€å€‹bufferçš„åŠŸèƒ½ï¼Œèƒ½å¤ ç·©è¡å°–å³°æµé‡ï¼Œåœ¨è³‡æºå›ºå®šçš„æƒ…æ³ä¸‹ï¼Œèƒ½å¤ è™•ç†æ›´å¤šçš„ä»»å‹™ï¼Œä»¥æ™‚é–“æ›å–è³‡æºï¼
ä½†æœ‰æ™‚è¨Šæ¯å¯èƒ½çœŸçš„å¤ªå¤šï¼Œç”¢ç”Ÿçš„é€Ÿåº¦å¿«æ–¼æ¶ˆè€—çš„é€Ÿåº¦ï¼Œæˆ–æ˜¯ä½ ç„¡æ³•æ¥å—å¤ªé•·çš„latencyï¼Œæ­¤æ™‚consumer processå°±å¯ä»¥éš¨æ™‚å¢åŠ å¤šå€‹ï¼Œä¸æœƒæœ‰è¡çªçš„é¢¨éšªï¼&lt;/p&gt;

&lt;h1 id=&quot;compare-to-restful-api&quot;&gt;Compare to RESTful API&lt;/h1&gt;

&lt;p&gt;åŒæ¨£éƒ½æ˜¯é€énetworkï¼Œprocessesä¹‹é–“çš„é€šè¨Šï¼Œä»–å€‘ä¹‹é–“æœ€å¤§çš„ä¸åŒå°±æ˜¯ä¸€å€‹æ˜¯asynchronous message passingï¼Œè€ŒHTTP requestæ˜¯synchronous(åŒæ­¥)çš„ï¼Œä¹Ÿå°±æ˜¯clientç™¼å‡ºäº†requestï¼Œæœƒç­‰å¾…åœ¨é‚£é‚Šï¼ŒæœŸå¾…è‘—responseå›ä¾†ï¼Œæ‰€ä»¥latencyå°±æ˜¯ä¸€å€‹é‡è¦çš„æŒ‡æ¨™ï¼Œä¹Ÿä¸»è¦å½±éŸ¿use casesçš„å› ç´ (è¦‹ä¸‹æ®µ)ï¼&lt;/p&gt;

&lt;h1 id=&quot;use-cases&quot;&gt;Use Cases&lt;/h1&gt;

&lt;h2 id=&quot;latencyä¸é‡è¦çš„æ™‚å€™&quot;&gt;Latencyä¸é‡è¦çš„æ™‚å€™&lt;/h2&gt;
&lt;p&gt;Sending emailsé€™é¡å·¥ä½œï¼Œä½¿ç”¨è€…å¯ä»¥æ¥å—ä¿¡æ™šå€‹å¹¾ç§’ï¼Œå¹¾åç§’ç”šè‡³å¹¾åˆ†é˜åˆ°æ™‚ï¼
æˆ–æ˜¯æ¯”å¦‚Buildä¸€å€‹ä½ çš„ç”¢å“çš„search indexï¼Œè³‡æ–™ä¸æ˜¯ç”±ä½¿ç”¨è€…å¯«å…¥ï¼Œä»–ä¹Ÿä¸æœƒçŸ¥é“ä½•æ™‚è³‡æ–™æ‡‰è©²è¦å‡ºç¾ï¼Œå°±ä¸æœƒæ€ªä½ çš„ç³»çµ±æ€éº¼é€™éº¼æ…¢æ‹‰ï¼&lt;/p&gt;

&lt;h2 id=&quot;computing-heavy-jobs&quot;&gt;Computing heavy jobs&lt;/h2&gt;
&lt;p&gt;æ¯”å¦‚èªªimage resizingæˆ–æ˜¯video encodingé€™é¡CPU intensiveçš„å·¥ä½œï¼Œä¸€ä¾†æ˜¯ä½¿ç”¨è€…ä¸Šå‚³å®Œåœ–ç‰‡å½±ç‰‡ï¼Œå¯èƒ½ä¸éœ€è¦ç­‰åˆ°é€™é¡éƒ½åšå®Œäº†ä½ æ‰è·Ÿä»–èªªokï¼ŒäºŒä¾†æ˜¯ä½ ä¹Ÿä¸æœƒæƒ³è®“é€™é¡å·¥ä½œblockä½æˆ–æ‹–å®ä½ çš„web serverçš„æ•ˆèƒ½ï¼&lt;/p&gt;

&lt;h2 id=&quot;ç„¡æ³•æ§åˆ¶çš„å·¥ä½œ&quot;&gt;ç„¡æ³•æ§åˆ¶çš„å·¥ä½œ&lt;/h2&gt;
&lt;p&gt;ç•¶ä½ çš„å·¥ä½œéœ€è¦å”èª¿è¨±å¤šè³‡æºæ‰èƒ½å®Œæˆæ™‚ï¼Œå¾€å¾€å¯èƒ½ä¸€å€‹è³‡æºoverloadedï¼Œå°±æœƒé€ æˆæ•´å€‹å·¥ä½œè®Šå¾—å¾ˆæ…¢ï¼Œå°¤å…¶æ˜¯ç•¶è³‡æºåˆæ˜¯å¤–éƒ¨çš„ä½ ç„¡æ³•æ§åˆ¶æ™‚ï¼&lt;/p&gt;

&lt;h1 id=&quot;tools&quot;&gt;Tools&lt;/h1&gt;
&lt;p&gt;ä¸»è¦çš„Message brokeråˆ†æˆå…©é¡ï¼Œå„é¡æ¯”è¼ƒçŸ¥åçš„åˆ†åˆ¥æ˜¯RabbitMQåŠKafkaï¼Œä»¥ä¸‹å°±ç°¡å–®è¬›ä¸€ä¸‹ä»–å€‘çš„ä¸åŒ&lt;/p&gt;
&lt;h2 id=&quot;rabbitmq&quot;&gt;RabbitMQ&lt;/h2&gt;
&lt;p&gt;TODO&lt;/p&gt;
&lt;h2 id=&quot;kafka&quot;&gt;Kafka&lt;/h2&gt;
&lt;p&gt;Durable and in-order. (TODOâ€¦&lt;/p&gt;

&lt;h1 id=&quot;tutorial&quot;&gt;Tutorial&lt;/h1&gt;
&lt;p&gt;ä¹‹å‰æœ‰å¯«éçš„ä½¿ç”¨&lt;a href=&quot;/posts/asynchronous-task-queue-using-redis-and-kue-js&quot;&gt;Redisä¾†ç•¶ä½œmessage brokerçš„ç¤ºç¯„&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;å¦‚æœä½ é€£Rediséƒ½ä¸æƒ³æ¶ï¼å¯ä»¥ä½¿ç”¨GCPçš„æœå‹™Pub/Subï¼Œä¸ŠGCPçš„ç¶²ç«™é»ä¸€é»ï¼Œé–‹ç®±å°±ç”¨ï¼&lt;/p&gt;</content><author><name></name></author><category term="Web Development" /><category term="message queue" /><summary type="html">åœ¨å¤§å‹ç¶²é æ‡‰ç”¨ç¨‹å¼ç³»çµ±ä¸­ï¼Œç•¶æˆ‘å€‘çš„æœå‹™è¶Šä¾†è¶Šå¤šï¼Œæœå‹™ä¹‹é–“å°±éœ€è¦æºé€šï¼Œé€éhttp restful apiï¼Œæƒ³å¿…å¤§å®¶éƒ½ä¸€å®šé‡éï¼Œæˆ–è¨±æˆ–å¤šæˆ–å°‘ä¹Ÿè½éä½¿ç”¨message queueï¼Œé‚£åˆ°åº•å®ƒæ˜¯ä»€éº¼ï¼Ÿç‚ºä»€éº¼è¦ç”¨å®ƒï¼Ÿä»¥åŠè·Ÿrestful apiæœ‰ä½•ä¸åŒçš„ä½¿ç”¨å ´æ™¯å‘¢ï¼Ÿ</summary></entry><entry><title type="html">å¿«é€Ÿæ“æœ‰ä¸€å€‹Asynchronous Task Queueï¼Œä½¿ç”¨Redis and Kue.js</title><link href="https://homuchen.com/posts/asynchronous-task-queue-using-redis-and-kue-js/" rel="alternate" type="text/html" title="å¿«é€Ÿæ“æœ‰ä¸€å€‹Asynchronous Task Queueï¼Œä½¿ç”¨Redis and Kue.js" /><published>2019-10-30T20:00:00+08:00</published><updated>2019-10-30T20:00:00+08:00</updated><id>https://homuchen.com/posts/asynchronous-task-queue-using-redis-and-kue-js</id><content type="html" xml:base="https://homuchen.com/posts/asynchronous-task-queue-using-redis-and-kue-js/">&lt;p&gt;é€™æ˜¯ç¯‡æ•™ä½ å¦‚ä½•åœ¨node.jsç’°å¢ƒä¸‹ï¼Œå¿«é€Ÿæ“æœ‰ä¸€å€‹Task queueçš„tutorialï¼Œå¦‚æœæƒ³äº†è§£ä»€éº¼æ˜¯message queueï¼Œä»¥åŠç‚ºä»€éº¼è·Ÿä»€éº¼æ™‚å€™è¦ä½¿ç”¨å®ƒï¼Œå¯ä»¥åƒè€ƒæˆ‘çš„&lt;a href=&quot;/posts/message-queue-advantages-use-cases&quot;&gt;å¦å¤–ä¸€ç¯‡æ–‡ç« &lt;/a&gt;!&lt;/p&gt;

&lt;h1 id=&quot;outline&quot;&gt;Outline&lt;/h1&gt;
&lt;ol&gt;
  &lt;li&gt;éƒ¨ç½²Redisï¼Œä½¿ç”¨Dockerï¼Œåœ¨æœ¬åœ°èµ·ä¸€å°Redis&lt;/li&gt;
  &lt;li&gt;ä»‹ç´¹Kue.js&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;éƒ¨ç½²redis&quot;&gt;éƒ¨ç½²Redis&lt;/h1&gt;

&lt;p&gt;å…ˆæº–å‚™ä¸€å€‹shell script run_redis.sh ï¼Œè¨˜éŒ„ä¸‹dockeræŒ‡ä»¤ï¼Œä»¥ä¾¿ä¹‹å¾Œç¹¼çºŒä½¿ç”¨ï¼Œå…§å®¹æŒ‡ä»¤å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/sh&lt;/span&gt;
docker run                        &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt;                              &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; 6379:6379                    &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$PWD&lt;/span&gt;/redis_data:/data        &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;--name&lt;/span&gt; my-redis                 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  redis
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è§£é‡‹ä¸€ä¸‹é€™å€‹dockeræŒ‡ä»¤å„å€‹åƒæ•¸çš„æ„ç¾©:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;-d åœ¨èƒŒæ™¯åŸ·è¡Œ&lt;/li&gt;
  &lt;li&gt;-p 6379:6379å°‡å®¹å™¨å…§çš„port:6379æ˜ å°„åˆ°æœ¬æ©Ÿçš„port:6379&lt;/li&gt;
  &lt;li&gt;-v å°‡å®¹å™¨å…§çš„æª”æ¡ˆæ›è¼‰åˆ°æœ¬æ©Ÿï¼Œæ­¤è™•å°‡å®¹å™¨å…§å­˜æ”¾redis è³‡æ–™çš„è³‡æ–™å¤¾ /data æ›è¼‰åˆ°$PWD/reids_dataï¼Œä¹Ÿå°±æ˜¯ç•¶å‰ç›®éŒ„çš„redis_dataè³‡æ–™å¤¾&lt;/li&gt;
  &lt;li&gt;redisç‚ºimageçš„åç¨±ï¼Œå¯ä»¥ç”¨ä¾‹å¦‚redis:latest, redis:5.0ï¼Œå¾Œé¢åŠ ä¸Šç‰ˆæœ¬è™Ÿï¼Œæ²’åŠ å°±æ˜¯latestï¼Œå¯ç”¨çš„ç‰ˆæœ¬åŠlatestæ˜¯å“ªä¸€ç‰ˆå¯ä»¥å¾æ­¤é€£çµæŸ¥è©¢https://hub.docker.com/_/redis/&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;åŸ·è¡Œå®Œä¹‹å¾ŒåŸ·è¡Œ docker ps å°±å¯ä»¥çœ‹åˆ°containerçš„è³‡è¨Šå¦‚ä¸‹&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://storage.googleapis.com/homuchen.com/images/kue-1.jpg&quot; alt=&quot;docker ps&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;ä»‹ç´¹kuejs&quot;&gt;ä»‹ç´¹Kue.js&lt;/h1&gt;

&lt;h2 id=&quot;å®‰è£&quot;&gt;å®‰è£&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$ npm install kue&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;connection&quot;&gt;Connection&lt;/h2&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;kue&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;kue&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;queue&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;kue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;createQueue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é è¨­æœƒé€£æ¥åˆ°127.0.01:6379çš„redisï¼Œå¦‚æœæƒ³è¦æ”¹è®Šï¼Œå¯ä»¥&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;queue&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;kue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;createQueue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;redis&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1234&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;10.0.50.20&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;auth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// if provided select a non-default redis db&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;// see https://github.com/mranney/node_redis#rediscreateclient&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;produce-message&quot;&gt;Produce message&lt;/h2&gt;

&lt;p&gt;é€£æ¥åˆ°message brokerå¾Œï¼Œå°±å¯ä»¥é–‹å§‹é€messageéå»æ‹‰ï½&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nx&quot;&gt;queue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;welcome email for tj&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;tj@learnboost.com&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;welcome-email&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
   &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;job&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€™è£¡æˆ‘å€‘ç™¼é€äº†ä¸€å€‹messageåˆ°åç‚ºemailçš„queueè£¡ï¼Œå…§å®¹å°±æ˜¯å€‹JSON object.&lt;/p&gt;

&lt;h2 id=&quot;consume-message&quot;&gt;Consume message&lt;/h2&gt;

&lt;p&gt;æ¥è‘—æˆ‘å€‘å°±å¯ä»¥åœ¨åˆ¥çš„åœ°æ–¹ï¼Œæ¥æ”¶ç™¼å‡ºå»çš„è¨Šæ¯åŠè™•ç†æ‹‰&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nx&quot;&gt;queue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;job&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;doSomethingWithData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;job&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  
  &lt;span class=&quot;nx&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//acknowledge this message&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;queue.processæ¥æ”¶å…©å€‹åƒæ•¸ï¼Œç¬¬ä¸€å€‹æ˜¯queueçš„åå­—ï¼Œé€™è£¡æ˜¯ä»¥â€™emailâ€™ç‚ºä¾‹ï¼Œç¬¬äºŒå€‹åƒæ•¸æ˜¯ä¸€å€‹callback functionï¼Œä»–æœ‰å…©å€‹åƒæ•¸ï¼Œåˆ†åˆ¥æ˜¯jobè·Ÿdoneï¼Œjob.dataå°±æ˜¯æˆ‘å€‘å‰›å‰›ç™¼é€å‡ºå»çš„messageï¼Œè€Œdoneæ˜¯ä¸€å€‹functionï¼Œç•¶ä½ ç¢ºå®šé€™å€‹messageå·²ç¶“è™•ç†å®Œçš„æ™‚å€™å¯ä»¥åŸ·è¡Œdone()&lt;/p&gt;

&lt;h2 id=&quot;concurrency-controll&quot;&gt;Concurrency controll&lt;/h2&gt;

&lt;p&gt;ä¸Šé¢ä¾‹å­ä¸­ï¼Œä¸€æ¬¡åªæœƒæ¥æ”¶ä¸€å€‹messageç›´åˆ°ä½ acké€™å€‹messageï¼Œå¦‚æœä½ çš„å·¥ä½œæ˜¯IOå¯†é›†çš„è©±ï¼Œä½ å¯èƒ½æœƒæƒ³ä¸€æ¬¡åŒæ™‚è™•ç†å¤šå€‹messageï¼Œæ­¤æ™‚å¯ä»¥åœ¨process functionä¸­ï¼ŒåŠ å…¥ç¬¬äºŒåƒæ•¸:&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;nx&quot;&gt;queue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;job&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;doSomethingWithData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;job&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  
  &lt;span class=&quot;nx&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//acknowledge this message&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é€™æ¨£ä¸€ä¾†ï¼Œé€™å€‹worker processåŒæ™‚å°±å¯ä»¥æ¥æ”¶è™•ç†10å€‹message!&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;ä»¥ä¸Šæ˜¯ç°¡å–®åœ°ä»‹ç´¹å¦‚ä½•é€£æ¥åˆ°message brokerï¼Œä»¥åŠç”¢ç”Ÿå’Œæ¶ˆè€—ä¿¡æ¯ï¼Œå®Œæ•´çš„èªªæ˜æ–‡ä»¶åŠæ›´å¤šåŠŸèƒ½ç”¨æ³•ï¼Œå¯ä»¥åˆ°githubä¸Šçœ‹çœ‹:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/Automattic/kue&quot;&gt;Automattic/kue&lt;/a&gt;&lt;/p&gt;</content><author><name></name></author><category term="Web Development" /><category term="message queue" /><category term="node.js" /><category term="redis" /><summary type="html">é€™æ˜¯ç¯‡æ•™ä½ å¦‚ä½•åœ¨node.jsç’°å¢ƒä¸‹ï¼Œå¿«é€Ÿæ“æœ‰ä¸€å€‹Task queueçš„tutorialï¼Œå¦‚æœæƒ³äº†è§£ä»€éº¼æ˜¯message queueï¼Œä»¥åŠç‚ºä»€éº¼è·Ÿä»€éº¼æ™‚å€™è¦ä½¿ç”¨å®ƒï¼Œå¯ä»¥åƒè€ƒæˆ‘çš„å¦å¤–ä¸€ç¯‡æ–‡ç« !</summary></entry><entry><title type="html">[Google Sheet]æˆ‘å¦‚ä½•è£½ä½œé€²åº¦è¡¨</title><link href="https://homuchen.com/posts/google-sheet-track-progress/" rel="alternate" type="text/html" title="[Google Sheet]æˆ‘å¦‚ä½•è£½ä½œé€²åº¦è¡¨" /><published>2019-08-14T20:00:00+08:00</published><updated>2019-08-14T20:00:00+08:00</updated><id>https://homuchen.com/posts/google-sheet-track-progress</id><content type="html" xml:base="https://homuchen.com/posts/google-sheet-track-progress/">&lt;p&gt;è¿½è¹¤æ¯é …ä»»å‹™åˆ°ç›®å‰ç‚ºæ­¢çš„é€²åº¦ï¼Œæˆ–æ¯æ®µæ™‚é–“(æ¯å¤©ã€æ¯å€‹ç¦®æ‹œã€æˆ–æ¯å€‹æœˆ)çš„åŠªåŠ›æƒ…æ³&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://storage.googleapis.com/homuchen.com/images/track-progress-1.jpg&quot; alt=&quot;google sheet chart&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é¦–å…ˆå…ˆæŠŠä»»å‹™è·Ÿæ™‚é–“è¼¸å…¥é€²å»ï¼Œå¦‚ä¸‹åœ–:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://storage.googleapis.com/homuchen.com/images/track-progress-2.jpg&quot; alt=&quot;google sheet chart&quot; /&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;æ™‚é–“åªè¦è¼¸å…¥å…©æ ¼å°±å¯ä»¥äº†ï¼Œé»ä½å³ä¸‹è§’çš„å°è—é»å¾€å³æ‹‰ï¼Œå°±æœƒè£œä¸Šä¸€æ¨£é–“è·çš„æ™‚é–“ï¼Œä¹Ÿå°±æ˜¯èªªé‚£å…©æ ¼å¦‚æœæ˜¯å·®ä¸€å¤©ï¼Œä¹‹å¾Œæ¯ä¸€æ ¼éƒ½æœƒå·®ä¸€å¤©ï¼Œä¸€å€‹ç¦®æ‹œã€ä¸€å€‹æœˆäº¦ç„¶ï¼&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ä»£è¡¨æ¯é …ä»»å‹™éœ€è¦å®Œæˆçš„å–®ä½ï¼Œç°¡å–®ç”¨æ•¸å­—é‡åŒ–è¡¨ç¤ºï¼Œæ¯”å¦‚ä¸€å ‚èª²æœ‰10é€±çš„èª²ç¨‹ï¼Œå°±è¼¸å…¥10ï¼&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;https://storage.googleapis.com/homuchen.com/images/track-progress-3.jpg&quot; alt=&quot;google sheet chart&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;æ¯å€‹æ™‚æ®µï¼Œå®ŒæˆæŸå€‹ä»»å‹™å¤šå°‘å–®ä½ï¼Œå°±å¡«åœ¨é€™å€‹åœ°æ–¹ï¼&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;C4é‚£æ ¼è£¡çš„å…¬å¼æ˜¯=sum(D4:Z4)/B4ï¼Œå°±æ˜¯ç°¡å–®åœ°å°‡åŒå€‹ä»»å‹™å³é‚Šçš„æ¯å€‹æ™‚æ®µå®Œæˆçš„å–®ä½(D4:Z4)åŠ èµ·ä¾†ï¼Œå†é™¤ä»¥Total Unit(B4)ï¼Œåšå®Œå¾Œå¾€ä¸‹æ‹‰ï¼Œæ¯å€‹ä»»å‹™çš„progresså°±éƒ½æœ‰äº†ï¼&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;https://storage.googleapis.com/homuchen.com/images/track-progress-4.jpg&quot; alt=&quot;google sheet chart&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;C4=SPARKLINE(SUM(D4:Z4)/B4,{â€œcharttypeâ€,â€barâ€;â€maxâ€,1}) ï¼Œé€™è£¡ä½¿ç”¨äº†SPARKLINEé€™å€‹å‡½å¼ï¼Œå°‡(4)æ‰€è¨ˆç®—å‡ºä¾†çš„å€¼ä¸Ÿé€²å»ç¬¬ä¸€å€‹åƒæ•¸ï¼Œç¬¬äºŒå€‹åƒæ•¸{â€œcharttypeâ€,â€barâ€;â€maxâ€,1}ä»£è¡¨è‘—æˆ‘å€‘è¦çš„æ˜¯æŸ±ç‹€åœ–ï¼Œä¸”æœ€å¤§å€¼ç‚º1ï¼Œå› ç‚ºé€²åº¦æ˜¯ä¸€å€‹0â€“1çš„æ•¸å­—ï¼&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;https://storage.googleapis.com/homuchen.com/images/track-progress-5.jpg&quot; alt=&quot;google sheet chart&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;å¢åŠ ä¸€åˆ—Totalï¼Œå°‡æ¯å€‹ä»»å‹™çš„Total unitï¼ŒprogressåŠæ¯å‘¨çš„é€²åº¦éƒ½åŠ ç¸½èµ·ä¾†ï¼Œä»¥æ­¤ç‚ºä¾‹B11 = SUM(B4:B10)ï¼Œç„¶å¾Œå†å¾€å³æ‹‰ï¼Œæ‡‰ç”¨åˆ°æ¯ä¸€æ ¼ä¸Šï¼&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;è£½ä½œæ¯æ™‚é–“å€é–“é€²åº¦æ¢ï¼Œåªæ˜¯å°‡ä¸Šè¿°ç¬¬6æ­¥é©Ÿçš„å€¼è¦–è¦ºåŒ–:&lt;/p&gt;

    &lt;ol&gt;
      &lt;li&gt;
        &lt;p&gt;å…ˆå°‡æ—¥æœŸä¸Šé¢çš„æ ¼å­å…¨éƒ¨åˆä½µæˆä¸€æ ¼ï¼Œå°‡D1:N1é¸èµ·ä¾†ï¼Œå¾æ ¼å¼ â†’ åˆä½µå„²å­˜æ ¼ â†’ å…¨éƒ¨åˆä½µ&lt;/p&gt;

        &lt;p&gt;&lt;img src=&quot;https://storage.googleapis.com/homuchen.com/images/track-progress-6.jpg&quot; alt=&quot;google sheet chart&quot; /&gt;&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;é€™ä¸€æ ¼ =SPARKLINE(D11:N11, {â€œcharttypeâ€,â€columnâ€})ï¼Œã„§æ¨£ä½¿ç”¨SPARKLINEå‡½å¼ï¼Œå¦‚æœæƒ³è¦ä¸€æ¢ç·šå°±=SPARKLINE(D11:N11)å°±å¥½ï¼Œçœ‹èµ·ä¾†å°±åƒé€™æ¨£&lt;/p&gt;

        &lt;p&gt;&lt;img src=&quot;https://storage.googleapis.com/homuchen.com/images/track-progress-7.jpg&quot; alt=&quot;google sheet chart&quot; /&gt;&lt;/p&gt;
      &lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;å¤§åŠŸå‘Šæˆï½ï½ğŸ‰ğŸ‰ğŸ‰&lt;/p&gt;</content><author><name></name></author><category term="GoogleSheet" /><category term="google sheet" /><category term="sparkline" /><summary type="html">è¿½è¹¤æ¯é …ä»»å‹™åˆ°ç›®å‰ç‚ºæ­¢çš„é€²åº¦ï¼Œæˆ–æ¯æ®µæ™‚é–“(æ¯å¤©ã€æ¯å€‹ç¦®æ‹œã€æˆ–æ¯å€‹æœˆ)çš„åŠªåŠ›æƒ…æ³</summary></entry><entry><title type="html">åˆ©ç”¨Dockerå»ºç«‹PostgreSQLé–‹ç™¼ç’°å¢ƒ</title><link href="https://homuchen.com/posts/docker-postgres-dev-environment/" rel="alternate" type="text/html" title="åˆ©ç”¨Dockerå»ºç«‹PostgreSQLé–‹ç™¼ç’°å¢ƒ" /><published>2018-07-25T12:19:15+08:00</published><updated>2018-07-25T12:19:15+08:00</updated><id>https://homuchen.com/posts/docker-postgres-dev-environment</id><content type="html" xml:base="https://homuchen.com/posts/docker-postgres-dev-environment/">&lt;p&gt;é¦–å…ˆå…ˆå°‡éœ€è¦çš„configuration variableæ”¾åˆ°ç’°å¢ƒè®Šæ•¸è£ï¼Œåœ¨é€™è£¡å°±æ˜¯æˆ‘å€‘çš„PostgreSQL database serverè¦èµ·åœ¨å“ªä¸€å€‹portï¼Œuserï¼Œpasswordï¼Œdbç­‰ç­‰ï¼Œæº–å‚™å¥½ä½ çš„ dev.envæª”æ¡ˆå¦‚ä¸‹ï¼Œç„¶å¾ŒåŸ·è¡Œ . ./dev.env&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;export PG_PORT=5432
export PG_USER=admin
export PG_PWD=secretpwd
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å†ä¾†æ˜¯ä¸€å€‹shell script run_postgres.sh ï¼Œè¨˜éŒ„ä¸‹dockeræŒ‡ä»¤ï¼Œä»¥ä¾¿ä¹‹å¾Œç¹¼çºŒä½¿ç”¨&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/sh&lt;/span&gt;
docker run                                  &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt;                                        &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$PG_PORT&lt;/span&gt;:5432                          &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;POSTGRES_USER&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$PG_USER&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;               &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;POSTGRES_PASSWORD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$PG_PASSWORD&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;       &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$PWD&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/pgdata&quot;&lt;/span&gt;:/var/lib/postgresql/data &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  postgres
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è§£é‡‹ä¸€ä¸‹é€™å€‹dockeræŒ‡ä»¤å„å€‹åƒæ•¸çš„æ„ç¾©:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;-d åœ¨èƒŒæ™¯åŸ·è¡Œ&lt;/li&gt;
  &lt;li&gt;-p $PG_PORT:5432 å°‡å®¹å™¨å…§çš„5432portæ˜ å°„åˆ°æœ¬æ©Ÿçš„$PG_PORT&lt;/li&gt;
  &lt;li&gt;-e æ³¨å…¥ç’°å¢ƒè®Šæ•¸åˆ°å®¹å™¨è£ï¼Œæœ‰å“ªäº›ç’°å¢ƒè®Šæ•¸å¯ç”¨ï¼Œå¯ä»¥åƒè€ƒå®˜æ–¹é€£çµhttps://hub.docker.com/_/postgres/&lt;/li&gt;
  &lt;li&gt;-v å°‡å®¹å™¨å…§çš„æª”æ¡ˆæ›è¼‰åˆ°æœ¬æ©Ÿï¼Œæ­¤è™•å°‡å®¹å™¨å…§å­˜æ”¾postgres è³‡æ–™çš„è³‡æ–™å¤¾ /var/lib/postgresql/data æ›è¼‰åˆ°$PWD/pgdataï¼Œä¹Ÿå°±æ˜¯ç•¶å‰ç›®éŒ„çš„pgdataè³‡æ–™å¤¾&lt;/li&gt;
  &lt;li&gt;postgresç‚ºimageçš„åç¨±ï¼Œå¯ä»¥ç”¨ä¾‹å¦‚postgres:latest, postgres:9.6ï¼Œå¾Œé¢åŠ ä¸Šç‰ˆæœ¬è™Ÿï¼Œæ²’åŠ å°±æ˜¯latestï¼Œå¯ç”¨çš„ç‰ˆæœ¬åŠlatestæ˜¯å“ªä¸€ç‰ˆå¯ä»¥å¾æ­¤é€£çµæŸ¥è©¢https://hub.docker.com/_/postgres/&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;åŸ·è¡Œå®Œä¹‹å¾ŒåŸ·è¡Œ docker ps å°±å¯ä»¥çœ‹åˆ°containerçš„è³‡è¨Šå¦‚ä¸‹&lt;/p&gt;

&lt;p&gt;æ¥ä¸‹ä¾†è¦é€²å»å®¹å™¨è£¡é¢create tableï¼Œä¸‹ä¸‹sqlæŒ‡ä»¤çš„è©±ï¼Œå°±æ˜¯åŸ·è¡Œ&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker exec -it {container id} psql -U $PG_USER&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;PG_USERæ˜¯æˆ‘å€‘çš„ç’°å¢ƒè®Šæ•¸ï¼Œé è¨­çš„DB(æ­¤è™•ç‚ºadmin)çš„åå­—å°±è·ŸPG_USERä¸€æ¨£ï¼Œé€²å»å®¹å™¨ä¹‹å¾Œçœ‹åˆ°å¦‚ä¸‹ï¼Œå°±å¯ä»¥é–‹å§‹ä½¿ç”¨æ‹‰ï½&lt;/p&gt;</content><author><name></name></author><category term="Web Development" /><category term="docker" /><category term="postgres" /><summary type="html">é¦–å…ˆå…ˆå°‡éœ€è¦çš„configuration variableæ”¾åˆ°ç’°å¢ƒè®Šæ•¸è£ï¼Œåœ¨é€™è£¡å°±æ˜¯æˆ‘å€‘çš„PostgreSQL database serverè¦èµ·åœ¨å“ªä¸€å€‹portï¼Œuserï¼Œpasswordï¼Œdbç­‰ç­‰ï¼Œæº–å‚™å¥½ä½ çš„ dev.envæª”æ¡ˆå¦‚ä¸‹ï¼Œç„¶å¾ŒåŸ·è¡Œ . ./dev.env</summary></entry><entry><title type="html">ä½¿ç”¨Node.js + Expressæ•´åˆLine Notifyé€šçŸ¥æœå‹™</title><link href="https://homuchen.com/posts/express-line-notify-service/" rel="alternate" type="text/html" title="ä½¿ç”¨Node.js + Expressæ•´åˆLine Notifyé€šçŸ¥æœå‹™" /><published>2017-12-28T20:00:00+08:00</published><updated>2017-12-28T20:00:00+08:00</updated><id>https://homuchen.com/posts/express-line-notify-service</id><content type="html" xml:base="https://homuchen.com/posts/express-line-notify-service/">&lt;p&gt;å¿«é€Ÿç°¡å–®åœ°ä½¿ç”¨ä¸€å€‹expressçš„middlewareå®Œæˆline notifyçš„oauth2æµç¨‹ï¼Œå–å¾—access_tokenä¾†åšå¾ŒçºŒçš„æ¶ˆæ¯æ¨é€&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨line notifyå¯ä»¥ç°¡å–®åœ°è®“ç¶²ç«™é–‹ç™¼è€…æ¨é€è¨Šæ¯åˆ°ä½¿ç”¨è€…çš„lineè£¡ï¼Œé›–ä¸åƒline botå¯ä»¥è·Ÿä½¿ç”¨è€…åšæ›´å¤šçš„äº’å‹•ï¼Œä½†å¦‚æœåªæ˜¯è¦å–®æ–¹é¢çš„çš„ç™¼é€è¨Šæ¯ï¼Œä½¿ç”¨line notifyå°±è¶³çŸ£ï¼Œè€Œä¸”é‚„ä¸åƒline botçš„push apiè¦æ”¶è²»ï¼Œé€™å€‹ä¸ç”¨éŒ¢ï½&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;ç™»å…¥æµç¨‹&quot;&gt;ç™»å…¥æµç¨‹&lt;/h1&gt;

&lt;p&gt;Line notifyçš„æµç¨‹å¤§è‡´ä¾†èªªæ˜¯é€™æ¨£çš„:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://storage.googleapis.com/homuchen.com/images/line-notify.jpg&quot; alt=&quot;Line Notify Login Flow&quot; /&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;GET https://notify-bot.line.me/oauth/authorize
    &lt;ul&gt;
      &lt;li&gt;å¸¶è‘—ä½ çš„client idåŠredirect_uriï¼ŒGETä¸Šé¢çš„urlï¼Œä½¿ç”¨è€…å°±æœƒè¢«å°åˆ°lineçš„ç™»å…¥é é¢&lt;/li&gt;
      &lt;li&gt;ç™»å…¥æˆåŠŸä¹‹å¾Œï¼Œlineé‚£é‚Šæœƒå€’å›ä¸Šè¿°çš„redirect_uriä¸¦ä¸”query stringå¸¶è‘—code
2.POST https://notify-bot.line.me/oauth/token&lt;/li&gt;
      &lt;li&gt;å°‡ç¬¬ä¸€æ­¥å¾—åˆ°çš„codeï¼Œpoståˆ°ä¸Šè¿°urlï¼Œå°±å¯ä»¥æ‹¿åˆ°ä¸€å€‹token&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;POST https://notify-bot.line.me/api/notify
    &lt;ul&gt;
      &lt;li&gt;å¸¶è‘—ä¸Šé¢æ­¥é©Ÿæ‰€å–å¾—çš„tokenåŠè¨Šæ¯ï¼Œpostä¸Šé¢çš„urlï¼Œä½¿ç”¨è€…å°±å¯ä»¥æ”¶åˆ°æ¶ˆæ¯æ‹‰ï½&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;å¥—ä»¶ä½¿ç”¨&quot;&gt;å¥—ä»¶ä½¿ç”¨&lt;/h1&gt;

&lt;p&gt;æ¥ä¸‹ä¾†è¦å¯¦ä½œä»¥ä¸Šæµç¨‹è¦ºå¾—å¥½éº»ç…©å–”ï½å°çš„å·²å°‡ä¸Šè¿°å‰å…©å€‹æ­¥é©Ÿå¯«æˆä¸€å€‹expressçš„middlewareä¾›å¤§å®¶ä½¿ç”¨ï¼Œèªªæ˜å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;npm install express-line-notify&lt;/li&gt;
  &lt;li&gt;å‚³å…¥configç‰©ä»¶ï¼Œéœ€è¦clientIdåŠclientSecret&lt;/li&gt;
  &lt;li&gt;é¸å€‹endpointä¾†èµ°ä»¥ä¸Šoauth2æµç¨‹ï¼Œè¨˜å¾—endpointè¦åŠ åœ¨callbackurlè£¡
    &lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;express&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;express&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;lineNotify&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;express-line-notify&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;config&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;clientId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;your-client-id&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;clientSecret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;your-client-secret&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;app&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;express&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;use&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;/endpoint_u_want_to_use&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;lineNotify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;otherMiddleware&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;listen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;4.å¦‚ä¸Šå¯¦ä½œä¹‹å¾Œï¼Œä¾¿å¯ä»¥åœ¨otherMiddlewareè£¡çš„req[â€˜line-notify-access-tokenâ€™]æ‹¿åˆ°tokenæ‹‰ï½å°±å¯é–‹ç™¼è€…è¦æ€éº¼ä½¿ç”¨äº†&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;hr /&gt;

&lt;p&gt;æœ€å¾Œé™„ä¸Šgit hub repositoryï¼Œæœ‰è¼ƒç‚ºè©³ç›¡çš„ä½¿ç”¨èªªæ˜ï¼&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/HoMuChen/express-line-notify&quot;&gt;HoMuChen/express-line-notify&lt;/a&gt;&lt;/p&gt;</content><author><name>HoMuChen</name></author><category term="Web Development" /><category term="express" /><category term="node.js" /><category term="line notify" /><category term="middleware" /><summary type="html">å¿«é€Ÿç°¡å–®åœ°ä½¿ç”¨ä¸€å€‹expressçš„middlewareå®Œæˆline notifyçš„oauth2æµç¨‹ï¼Œå–å¾—access_tokenä¾†åšå¾ŒçºŒçš„æ¶ˆæ¯æ¨é€</summary></entry></feed>